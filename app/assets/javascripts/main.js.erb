$(document).ready(function() {
  let request = $.ajax({
    url: '/radio'
  });
  request.done((response) => {
    const tracks = response.tracks;
    const randomNumber = Math.floor((Math.random() * tracks.length) + 1);
    track = tracks[randomNumber];
    trackId = track.id
    trackName = track.title
    trackUrl = track.permalink_url

    SC.initialize({
      client_id: '<%= ENV['CLIENT_ID'] %>'
    });

    SC.stream('/tracks/' + trackId, function(sound) {
      let playing = false;

      $('.track-name').html(trackName);
      $('.track-name').attr('href', trackUrl);

      $('.radio').on('click', '#play-pause', function(event) {
        event.preventDefault();
        if (playing === true) {
          sound.pause();
          playing = false;
          $(this).children('img').attr('src','assets/play.png');
        } else {
          sound.play()
          playing = true;
          $(this).children('img').attr('src','assets/pause.png');
        }
      });
    });
  });
});
